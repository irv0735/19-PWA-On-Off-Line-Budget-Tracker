(()=>{let e,t,n=[];const o=indexedDB.open("BudgetDB",35);function r(){let e=t.transaction(["BudgetStore"],"readwrite");const n=e.objectStore("BudgetStore").getAll();n.onsuccess=function(){n.result.length>0&&fetch("/api/transaction/bulk",{method:"POST",body:JSON.stringify(n.result),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then((e=>e.json())).then((n=>{0!==n.length&&(e=t.transaction(["BudgetStore"],"readwrite"),e.objectStore("BudgetStore").clear(),console.log("Clearing store 🧹"))}))}}function a(){let e=n.reduce(((e,t)=>e+parseInt(t.value)),0);document.querySelector("#total").textContent=e}function l(){let e=document.querySelector("#tbody");e.innerHTML="",n.forEach((t=>{let n=document.createElement("tr");n.innerHTML=`\n      <td>${t.name}</td>\n      <td>${t.value}</td>\n    `,e.appendChild(n)}))}function c(){let t=n.slice().reverse(),o=0,r=t.map((e=>{let t=new Date(e.date);return`${t.getMonth()+1}/${t.getDate()}/${t.getFullYear()}`})),a=t.map((e=>(o+=parseInt(e.value),o)));e&&e.destroy();let l=document.getElementById("myChart").getContext("2d");e=new Chart(l,{type:"line",data:{labels:r,datasets:[{label:"Total Over Time",fill:!0,backgroundColor:"#6666ff",data:a}]}})}function i(e){let o=document.querySelector("#t-name"),r=document.querySelector("#t-amount"),i=document.querySelector(".form .error");if(""===o.value||""===r.value)return void(i.textContent="Missing Information");i.textContent="";let u={name:o.value,value:r.value,date:(new Date).toISOString()};e||(u.value*=-1),n.unshift(u),c(),l(),a(),fetch("/api/transaction",{method:"POST",body:JSON.stringify(u),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{e.errors?i.textContent="Missing Information":(o.value="",r.value="")})).catch((e=>{var n;n=u,t.transaction(["BudgetStore"],"readwrite").objectStore("BudgetStore").add(n),o.value="",r.value=""}))}o.onupgradeneeded=function(e){const{oldVersion:n}=e,o=e.newVersion||t.version;console.log(`DB Updated from version ${n} to ${o}`),t=e.target.result,0===t.objectStoreNames.length&&t.createObjectStore("BudgetStore",{autoIncrement:!0})},o.onerror=function(e){console.log(`Woops! ${e.target.errorCode}`)},o.onsuccess=function(e){t=e.target.result,navigator.onLine&&(console.log("Backend online! 🗄️"),r())},fetch("/api/transaction").then((e=>e.json())).then((e=>{n=e,a(),l(),c()})),document.querySelector("#add-btn").onclick=function(){i(!0)},document.querySelector("#sub-btn").onclick=function(){i(!1)},window.addEventListener("online",r)})();